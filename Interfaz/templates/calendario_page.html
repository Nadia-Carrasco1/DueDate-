{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-6">
  <h1 class="text-center mb-4">Calendario de Tareas</h1>

  <div id="calendar" 
       class="bg-white rounded-2xl shadow p-4 mx-auto text-capitalize" 
       style="height: 600px; max-width: 900px; overflow: hidden;">
  </div>
</div>


<div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="taskModalLabel">Detalles de la tarea</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p><strong>Título:</strong> <span id="modalTaskTitle"></span></p>
        <p><strong>Descripción:</strong> <span id="modalTaskDescription"></span></p>
        <p><strong>Fecha de vencimiento:</strong> <span id="modalTaskDate"></span></p>
        <p><strong>Estado:</strong> <span id="modalTaskStatus" class="badge"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>


<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<link href="{% static 'calendario.css' %}" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'es',
      events: [
        {% for task in tasks %}
          {
            title: "{{ task.title|escapejs }}",
            start: "{{ task.due_date|date:'Y-m-d' }}",
            color: "{% if task.status == 'completada' %}#28a745{% elif task.status == 'pendiente' %}#FFBB00{% else %}#dc3545{% endif %}",
            extendedProps: {
              description: "{{ task.description|escapejs }}",
              status: "{{ task.status }}"
            }
          }{% if not forloop.last %},{% endif %}
        {% endfor %}
      ],


      eventClick: function(info) {
        document.getElementById('modalTaskTitle').innerText = info.event.title;
        document.getElementById('modalTaskDescription').innerText = info.event.extendedProps.description || "Sin descripción";
        document.getElementById('modalTaskDate').innerText = info.event.start.toLocaleDateString('es-ES');
        

        let statusEl = document.getElementById('modalTaskStatus');
        if (info.event.extendedProps.status === "completada") {
          statusEl.innerText = "Completada";
          statusEl.className = "badge bg-success";
        } else if (info.event.extendedProps.status === "pendiente") {
          statusEl.innerText = "Pendiente";
          statusEl.className = "badge bg-warning text-dark";
        } else {
          statusEl.innerText = "Vencida";
          statusEl.className = "badge bg-danger";
        }


        var taskModal = new bootstrap.Modal(document.getElementById('taskModal'));
        taskModal.show();
      }
    });
    calendar.render();
  });
</script>

{% endblock %}
