{% extends "Base.html" %}

{% block content %}
    <style>
        /* AlertifyJS */

        .ajs-button.ajs-ok {
            background-color: #6a5acd; 
            color: white; 
            border-color: #6a5acd;
            padding: 10px;
            border-radius: 10px;
        }

       .ajs-button.ajs-ok:hover {
            background-color: #342c5f;
        }
        .ajs-header, .ajs-body {
            font-weight: 600;
        }
        .ajs-body {
            padding: 10px;
            padding-left: 0px;
            font-size: large;
        }

        .ajs-close {
            display: none !important;
        }

        /* CronÃ³metro */
        .text-main-violet {
            color: #6a5acd !important;
        }
        .text-main-black {
            color: rgb(44, 43, 43) !important;
        }
        .btn-main-violet {
            background-color: #6a5acd !important;
            border-color: #6a5acd !important;
            color: #fff !important;
        }
        .btn-outline-main-violet {
            color: #6a5acd !important;
            border-color: #6a5acd !important;
        }

        .text-dark-violet {
            color: #342c5f !important;
        }
        .bg-dark-violet {
            background-color: #342c5f !important;
            color: #fff !important;
        }
        .bg-green {
            background-color: #28a745 !important;
            color: #fff !important;
        }
        .text-green {
            color: #28a745 !important;
        }
        
        .btn-main-violet:hover, .btn-main-violet:focus {
            background-color: #342c5f !important;
            border-color: #342c5f !important;
            color: #fff !important;
            opacity: 0.9;
        }
        
        .nudge-up {
            transform: translateY(-10%); 
        }
    </style>

    <div class="d-flex justify-content-center align-items-center min-vh-100 w-100">

        <div class="container p-4 rounded shadow-lg bg-white nudge-up" style="max-width: 800px;">
            
            <h1 class="text-center mb-4 text-dark-violet">
                <i class="bi bi-clock-fill me-2"></i> CronÃ³metro de estudio ðŸ“š
            </h1>
            
            <p class="text-center text-muted mb-4">
                <span class="badge bg-dark-violet me-2">Estudio: {{ page.tiempo_estudio }}</span>
                <span class="badge bg-green">Descanso: {{ page.tiempo_descanso }}</span>
            </p>

            <div class="text-center mb-3">
                <h2 id="tiempo-visor" class="display-1 fw-semibold text-main-black">00:00:00</h2>
            </div>
            
            <p id="modo-actual" class="text-center fs-5 fw-semibold mb-4">
                Modo <span class="text-main-violet" id="modo">Estudio</span>
            </p>

            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                
                <button id="btn-iniciar" class="btn btn-lg btn-main-violet">
                    <i class="bi bi-play-fill"></i> Iniciar
                </button>
                
                <button id="btn-pausar" class="btn btn-lg btn-warning text-dark" disabled> 
                    <i class="bi bi-pause-fill"></i> Pausar
                </button>
                
                <button id="btn-reiniciar" class="btn btn-lg btn-outline-main-violet">
                    <i class="bi bi-arrow-counterclockwise"></i> Reiniciar
                </button>
                
            </div>
    <script>
        const tiempoEstudioInicial = {{ page.tiempo_estudio.total_seconds|default:3000|floatformat:0 }}; // 50 minutos
        const tiempoDescansoInicial = {{ page.tiempo_descanso.total_seconds|default:600|floatformat:0 }}; // 10 minutos
        
        let estaCorriendo = false;
        let esModoEstudio = true;
        let tiempoRestante = tiempoEstudioInicial;
        let intervaloTemporizador;

        const visorTiempo = document.getElementById('tiempo-visor');
        const visorModo = document.getElementById('modo-actual');
        console.log(visorModo.textContent);
        const btnIniciar = document.getElementById('btn-iniciar');
        const btnPausar = document.getElementById('btn-pausar');
        const btnReiniciar = document.getElementById('btn-reiniciar');
        const modo = document.getElementById('modo');

        const textoDeModo = modo.textContent == 'Estudio' ? 'descanso' : 'estudio';

        function actualizarVista() {
            const horas = Math.floor(tiempoRestante / 3600);
            const segundosDespuesDeHoras = tiempoRestante % 3600;
            const minutos = Math.floor(segundosDespuesDeHoras / 60);
            
            const segundos = segundosDespuesDeHoras % 60;
            
            const horasVisor = String(horas).padStart(2, '0');
            const minutosVisor = String(minutos).padStart(2, '0');
            const segundosVisor = String(segundos).padStart(2, '0');
            
            const visor = `${horasVisor}:${minutosVisor}:${segundosVisor}`;
                
            visorTiempo.textContent = visor;
        }

        function cambiarModo() {
            esModoEstudio = !esModoEstudio;
            btnIniciar.disabled = false;
            
            if (esModoEstudio) {
                tiempoRestante = tiempoEstudioInicial;
                visorModo.innerHTML = "Modo Estudio";
            } else {
                tiempoRestante = tiempoDescansoInicial;
                visorModo.innerHTML = "Modo Descanso";
            }
            actualizarVista();
        }
        
        function tic() {
            if (tiempoRestante > 0) {
                tiempoRestante--;
                actualizarVista();
            } else {
                // Detiene el temporizador
                clearInterval(intervaloTemporizador);
                estaCorriendo = false; 

                let title, text; // varibles para la libreria de alertas

                if (esModoEstudio) {
                    title = "Â¡Ã‰xito!";
                    text = "Â¡Tiempo de <span class='text-main-violet'>estudio</span> terminado! Hora de descansar.";
                } else {
                    title = "Â¡Bien!";
                    text = "Â¡<span class='text-green'>Descanso</span> terminado! De vuelta al trabajo.";
                }

                alertify.alert(title, text, function(){
                    cambiarModo();
                    iniciarTemporizador()
                }).set({
                    'label': 'Comenzar ' + textoDeModo
                }); 
            }
        }

        function iniciarTemporizador() {
            if (!estaCorriendo) {
                estaCorriendo = true;
                btnIniciar.disabled = true;
                btnPausar.disabled = false;
                intervaloTemporizador = setInterval(tic, 1000); 
            }
        }

        function pausarTemporizador() {
            if (estaCorriendo) {
                estaCorriendo = false;
                btnIniciar.disabled = false;
                btnPausar.disabled = true;
                clearInterval(intervaloTemporizador);
            }
        }

        function reiniciarTemporizador() {
            pausarTemporizador();
            esModoEstudio = true;
            tiempoRestante = tiempoEstudioInicial;
            actualizarVista();
        }

        btnIniciar.addEventListener('click', iniciarTemporizador);
        btnPausar.addEventListener('click', pausarTemporizador);
        btnReiniciar.addEventListener('click', reiniciarTemporizador);

        actualizarVista();
    </script>
</div>
{% endblock %}